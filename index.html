<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Satsang Allocation Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f9; padding: 20px; line-height: 1.6; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2 { color: #2c3e50; text-align: center; margin-bottom: 20px; }
        .input-group { margin-bottom: 15px; display: flex; flex-direction: column; }
        label { font-weight: bold; margin-bottom: 5px; color: #34495e; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 14px; }
        textarea { height: 120px; }
        .row { display: flex; gap: 20px; margin-bottom: 15px; }
        .row .input-group { flex: 1; }
        .controls { display: flex; gap: 10px; margin: 25px 0; justify-content: center; }
        button { padding: 12px 25px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; transition: 0.3s; font-size: 15px; }
        .btn-generate { background-color: #27ae60; color: white; }
        .btn-pdf { background-color: #2980b9; color: white; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        #output { background: #fff; border: 1px solid #ddd; padding: 40px; white-space: pre-wrap; font-family: 'Courier New', Courier, monospace; font-size: 14px; color: #000; }
    </style>
</head>
<body>

<div class="container">
    <h2>Satsang Chanting Allocator</h2>
    
    <div class="row">
        <div class="input-group">
            <label for="satsangDate">Satsang Date:</label>
            <input type="text" id="satsangDate" placeholder="e.g. 27.12.2025">
        </div>
        <div class="input-group">
            <label for="satsangTime">Satsang Time:</label>
            <input type="text" id="satsangTime" placeholder="e.g. 09.00AM">
        </div>
    </div>

    <div class="input-group">
        <label for="nameInput">Devotee Names (one per line):</label>
        <textarea id="nameInput">K Sujatha
Hema
Vijaya Laxmi
Sudarshan
Sukanya
Sridevi
Sukshma
Madhavi
Geeta
Narayana
Open Slot 1</textarea>
    </div>

    <div class="controls">
        <button class="btn-generate" onclick="generateAllocation()">Randomize & Generate</button>
        <button class="btn-pdf" onclick="exportPDF()">Export to PDF</button>
    </div>

    <div id="output">
        </div>
</div>

<script>
    function generateAllocation() {
        const input = document.getElementById('nameInput').value.trim();
        const dateVal = document.getElementById('satsangDate').value.trim() || "DD.MM.YYYY";
        const timeVal = document.getElementById('satsangTime').value.trim() || "00:00AM";
        
        let names = input.split('\n').map(n => n.trim()).filter(n => n !== "");
        
        if (names.length < 2) {
            alert("Please enter at least a few names.");
            return;
        }

        const shuffle = (array) => {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        };

        const getRand = () => names[Math.floor(Math.random() * names.length)];
        
        let pNames = shuffle([...names]);
        let sNames = shuffle([...names]);
        let phNames = shuffle([...names]);

        let html = `*Om Namo Narayana*\n`;
        html += `--------------------------------------------\n`;
        html += `Batch Number: A1812/2290  [Satsang Date: ${dateVal}] - ${timeVal}\n`;
        html += `--------------------------------------------\n`;
        html += `Starting Prayer: ${getRand()}\n`;
        html += `Pledge: ${getRand()}\n\n`;

        const pRanges = [
            "1-2-[2]", "3-4-[2]", "5-6-[2]", "7-8-[2]", "9-10-[2]", 
            "11-13-[3]", "14-16-[3]", "17-18-[2]", "19-20-[2]", "21-22-[2]"
        ];
        pRanges.forEach((range, i) => {
            html += `Poorvangam: ${range.padEnd(10)}------  ${pNames[i % pNames.length]}\n`;
        });

        html += `\nNyasa: ------------------${getRand()}\n\n`;

        html += `Dhyaanam: 1-3------------${getRand()}\n`;
        html += `Dhyaanam: 4-8------------${getRand()}\n\n`;

        const sRanges = [
            "1-5-[5]", "6-11-[6]", "12-17-[6]", "18-22-[5]", "23-28-[6]", 
            "29-34-[6]", "35-39-[5]", "40-45-[6]", "46-51-[6]", "52-56-[5]",
            "57-62-[6]", "63-68-[6]", "69-73-[5]", "74-79-[6]", "80-85-[6]",
            "86-90-[5]", "91-96-[6]", "97-102-[6]", "103-108-[6]"
        ];
        sRanges.forEach((range, i) => {
            html += `Shlokam: ${range.padEnd(12)}-------    ${sNames[i % sNames.length]}\n`;
        });

        html += `\n`;
        const phRanges = [
            "1-3-[3]", "4-6-[3]", "7-9-[3]", "10-13-[4]", "14-17-[4]",
            "18-21-[4]", "22-25-[4]", "26-28-[3]", "29-31-[3]", "32-33-[2]"
        ];
        phRanges.forEach((range, i) => {
            html += `Phalashruti: ${range.padEnd(11)}------ ${phNames[i % phNames.length]}\n`;
        });

        html += `\nKshama Prarthana, Ending Prayer: ${getRand()}\n\n`;
        html += `Backups:\n`;
        html += `* ${getRand()} (1-35)\n`;
        html += `* ${getRand()} (26-75)\n`;
        html += `* ${getRand()} (76-108)\n`;
        html += `* ${getRand()} (Phalashruti - ending)`;

        document.getElementById('output').innerText = html;
    }

    function exportPDF() {
        const element = document.getElementById('output');
        if (element.innerText.trim() === "") {
            alert("Generate the allocation first!");
            return;
        }
        const opt = {
            margin:       10,
            filename:     'Satsang_Allocation.pdf',
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { scale: 2 },
            jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        html2pdf().set(opt).from(element).save();
    }
</script>

</body>
</html>
